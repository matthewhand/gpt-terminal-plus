# GPT-Terminal-Plus with Flux Image Generation

This project extends the [GPT-Terminal-Plus](https://github.com/matthewhand/gpt-terminal-plus/) with the ability to generate images using the Flux model. The stack includes a built-in web server to serve these images, and optionally, Ngrok can be configured to expose the web server to the public internet.

## Table of Contents
- [Architecture Overview](#architecture-overview)
- [Prerequisites](#prerequisites)
- [Getting Started](#getting-started)
- [Generating Images](#generating-images)
- [Accessing Generated Images](#accessing-generated-images)
- [Technical Details](#technical-details)
- [Troubleshooting](#troubleshooting)
- [Conclusion](#conclusion)

## Architecture Overview

This stack consists of three main services managed by Docker Compose:

1. **Flux Service**: A GPU-accelerated service for generating images using the Flux model.
2. **GPT-Terminal**: The main terminal interface that interacts with the Flux service.
3. **NGINX Web Server**: Serves the images generated by the Flux service, with optional public exposure via Ngrok.

## Prerequisites

Before starting, ensure you have the following installed:

- [Docker](https://docs.docker.com/get-docker/)
- [Docker Compose](https://docs.docker.com/compose/install/)
- [Ngrok](https://ngrok.com/) (optional, if you want to expose the web server publicly)

## Getting Started

### 1. Clone the Repository

Clone the `gpt-terminal-plus` repository to your local machine:

```bash
git clone https://github.com/matthewhand/gpt-terminal-plus.git
cd gpt-terminal-plus
```

### 2. Configure Environment Variables

Create a `.env` file in the `docker/flux-service/` directory based on the provided `.env.sample`:

```bash
cp docker/flux-service/.env.sample docker/flux-service/.env
```

Edit the `.env` file to include your credentials and settings:

```env
API_TOKEN=your_secure_api_token
NODE_ENV=production
DEBUG=app:*
NVIDIA_VISIBLE_DEVICES=all
NVIDIA_DRIVER_CAPABILITIES=compute,utility
NGROK_AUTHTOKEN=your_ngrok_authtoken  # Only if using Ngrok
```

### 3. Build and Launch the Stack

Use Docker Compose to build and start the services:

```bash
docker-compose up --build
```

This command will:
- Build and start the `flux-service` for image generation.
- Launch the `gpt-terminal` for interacting with the Flux service.
- Start the NGINX web server to serve generated images.
- Optionally, expose the web server with Ngrok if configured.

## Generating Images

To generate images using the Flux service, interact with the GPT terminal. The terminal will send requests to the Flux service, which processes the request and saves the generated images to the `output` directory.

## Accessing Generated Images

Once an image is generated, you can access it through the NGINX web server:

- **Local Access**: 
  ```bash
  http://localhost:8080/generated_image.png
  ```

- **Ngrok Access** (if configured):
  ```bash
  http://your-ngrok-id.ngrok.io/generated_image.png
  ```

## Technical Details

### Docker Compose Overview

- **`flux-service`**:
  - Uses NVIDIA's CUDA runtime for GPU-accelerated image generation.
  - Shares the `output` directory with the host and NGINX container.

- **`gpt-terminal`**:
  - The primary interface for interacting with the Flux service.
  - Runs in a separate container to maintain a clean separation of concerns.

- **`nginx`**:
  - Serves files from the `output` directory.
  - Can be accessed locally or via Ngrok for remote access.

### Volume Sharing

The `output` directory is shared between the `flux-service` and NGINX container. This setup allows images generated by the Flux service to be instantly accessible via the web server.

### Ngrok Integration

If Ngrok is configured using the `NGROK_AUTHTOKEN`, the NGINX server will be exposed to the internet, allowing you to share the generated images with others easily.

## Troubleshooting

- **GPU Not Detected**: Make sure NVIDIA drivers and Docker's NVIDIA runtime are correctly installed.
- **Ngrok Issues**: Ensure your Ngrok authtoken is correctly set in the `.env` file and that Ngrok is installed.

## Conclusion

This setup extends the capabilities of GPT-Terminal-Plus by adding image generation with Flux and serving these images via a built-in web server. With optional Ngrok integration, you can easily share the generated images over the internet.
