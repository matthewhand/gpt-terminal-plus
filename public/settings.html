<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Settings Panel</title>
  <style>
    body { font-family: sans-serif; padding: 2em; max-width: 600px; }
    label { display: block; margin-top: 1em; }
    input, select { width: 100%; padding: 0.5em; margin-top: 0.25em; }
    .advanced { margin-top: 2em; border-top: 1px solid #ccc; padding-top: 1em; }
  </style>
</head>
<body>

<h1>Server Settings</h1>

<form id="settings-form">
  <label>
    AI Feedback Mode
    <select name="WEBUI_LLM_ANALYSIS_MODE">
      <option value="off">Off</option>
      <option value="onError">On Error</option>
      <option value="always">Always</option>
    </select>
  </label>

  <label>
    LLM Engine
    <select name="LLM_ENGINE">
      <option value="interpreter">Interpreter</option>
      <option value="codex">Codex</option>
    </select>
  </label>

  <label>
    Local Timeout (ms)
    <input type="number" name="LOCAL_TIMEOUT" value="5000" />
  </label>

  <label>
    Allowed Shells (comma-separated)
    <input type="text" name="EXECUTION_ALLOWED_SHELLS" value="bash,sh" />
  </label>

  <div class="advanced">
    <h2>Advanced Overrides</h2>
    <label>
      Custom Config (JSON)
      <textarea name="customConfig" rows="8" placeholder='{"SSH_TIMEOUT":60000,"SSM_TIMEOUT":90000}'></textarea>
    </label>
  </div>

  <button type="submit">Apply Settings</button>
</form>

<script>
  document.getElementById('settings-form').addEventListener('submit', e => {
    e.preventDefault();
    const form = e.target;
    const data = Object.fromEntries(new FormData(form).entries());
    const customOverrides = JSON.parse(data.customConfig || '{}');
    delete data.customConfig;
    const payload = { ...data, ...customOverrides };
    fetch('/config/override', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    }).then(res => alert('Settings applied'));
  });
</script>

</body>
</html>